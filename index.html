<script>
  /* ============================
     1. GOOGLE SHEETS CSV URLS
     ============================ */
  const URL_300  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTo4pC3erQX6RWtulE08AgfjpGAeCgG4QCB1JvM005F21JrpD1IIdpE1axoNQN19pJDqGICriWnvcUA/pub?gid=0&single=true&output=csv";
  const URL_11   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTo4pC3erQX6RWtulE08AgfjpGAeCgG4QCB1JvM005F21JrpD1IIdpE1axoNQN19pJDqGICriWnvcUA/pub?gid=1645007257&single=true&output=csv";
  const URL_800  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTo4pC3erQX6RWtulE08AgfjpGAeCgG4QCB1JvM005F21JrpD1IIdpE1axoNQN19pJDqGICriWnvcUA/pub?gid=288383571&single=true&output=csv";
  const URL_1100 = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTo4pC3erQX6RWtulE08AgfjpGAeCgG4QCB1JvM005F21JrpD1IIdpE1axoNQN19pJDqGICriWnvcUA/pub?gid=1815197466&single=true&output=csv";

  /* ============================
     2. CSV FETCH + PARSE
     ============================ */
  async function fetchCsv(url) {
    const res = await fetch(url);
    const text = await res.text();
    const lines = text.trim().split(/\r?\n/);
    const rows = lines.map(line => line.split(","));
    const header = rows[0];
    const dataRows = rows.slice(1);

    const colFirst = header.indexOf("FirstName");
    const colLast  = header.indexOf("LastName");
    const colScore = header.indexOf("Score");

    return dataRows
      .filter(r => r[colFirst] || r[colLast])
      .map(r => ({
        first: (r[colFirst] || "").trim(),
        last:  (r[colLast]  || "").trim(),
        score: (r[colScore] || "").trim()
      }));
  }

  /* ============================
     3. RENDER FUNCTIONS
     ============================ */

  function render300Games(entries, container) {
    const counts = new Map();
    entries.forEach(e => {
      const name = `${e.first} ${e.last}`.trim();
      if (!name) return;
      counts.set(name, (counts.get(name) || 0) + 1);
    });

    const sorted = Array.from(counts.entries())
      .sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));

    container.innerHTML = "";
    sorted.forEach(([name, count]) => {
      const div = document.createElement("div");
      div.className = "entry";
      div.innerHTML = `<span class="count">${count}×</span> — ${name}`;
      container.appendChild(div);
    });
  }

  function renderScoreList(entries, container) {
    const sorted = entries
      .filter(e => e.first || e.last)
      .sort((a, b) => {
        const nameA = `${a.last} ${a.first}`.trim().toLowerCase();
        const nameB = `${b.last} ${b.first}`.trim().toLowerCase();
        return nameA.localeCompare(nameB);
      });

    container.innerHTML = "";
    sorted.forEach(e => {
      const name = `${e.first} ${e.last}`.trim();
      const text = e.score ? `${name} — ${e.score}` : name;
      const div = document.createElement("div");
      div.className = "entry";
      div.textContent = text;
      container.appendChild(div);
    });
  }

  /* ============================
     4. MAIN LOAD + SCROLL SETUP
     ============================ */
  window.addEventListener('load', async () => {

    const cat300  = document.querySelector("#cat-300 .category-entries");
    const cat11   = document.querySelector("#cat-11 .category-entries");
    const cat800  = document.querySelector("#cat-800 .category-entries");
    const cat1100 = document.querySelector("#cat-1100 .category-entries");

    try {
      const [data300, data11, data800, data1100] = await Promise.all([
        fetchCsv(URL_300),
        fetchCsv(URL_11),
        fetchCsv(URL_800),
        fetchCsv(URL_1100)
      ]);

      render300Games(data300, cat300);
      renderScoreList(data11, cat11);
      renderScoreList(data800, cat800);
      renderScoreList(data1100, cat1100);

    } catch (e) {
      console.error("Error loading honor board data:", e);
    }

    // SCROLL LOGIC — now delayed 3 seconds
    const content = document.getElementById('scrollContent');
    const wrapper = document.querySelector('.scroll-wrapper');
    const stack = document.getElementById('stack');
    const duplicate = document.getElementById('stack-duplicate');

    // Duplicate AFTER data loads
    duplicate.innerHTML = stack.innerHTML;

    // Recalculate height AFTER rendering
    const contentHeight = content.offsetHeight;
    const wrapperHeight = wrapper.offsetHeight;

    const speed = 20; // pixels per second
    const distance = contentHeight / 2 + wrapperHeight;
    const duration = distance / speed;

    // Start at the top
    content.style.transform = "translateY(0)";

    // Delay scroll start by 3 seconds
    setTimeout(() => {
      content.style.animation = `scroll-up ${duration}s linear infinite`;
    }, 3000);

  });
</script>

